---
layout: post
title:  interrupt
categories: operation_system
---

Linux 将中断处理过程分成了两个部分：

* 上半部

  会打断 cpu 正在执行的任务，然后立即快速处理中断。它在中断禁止模式下运行，主要处理跟硬件紧密相关的或时间敏感的工作。

* 下半部

  延迟处理上半部未完成的工作，通常以内核线程的方式运行。每个 cpu 都有一个软中断内核线程，例如，0 号 cpu 对应的软中断内核线程的名字就是 ksoftirqd/0

例如：

网卡接收到数据包后，会通过硬中断的方式，通知内核有新的数据到了。这时，内核就应该调用中断处理程序来响应它。

* 上半部要把网卡的数据读到内存中，然后更新一下硬件寄存器的状态，最后发送一个软中断信号，通知下半部做进一步的处理。

* 下半部被软中断信号唤醒后，需要从内存中找到网络数据，再按照网络协议栈，对数据进行逐层解析和处理，最后把它送给应用程序。

